function randfunc(e,t){return Math.floor(Math.random()*(t-e)+e)}var c=document.getElementById("effect"),cw,ch;c.width=cw=window.innerWidth-10,c.height=ch=window.innerHeight-10;var ctx=c.getContext("2d"),audioCtx=new(window.AudioContext||window.webkitAudioContext),Loader=function(e){this.url=""};Loader.prototype.loadBuffer=function(){var e,t;e=this,t=new XMLHttpRequest,t.open("GET",this.url,!0),t.responseType="arraybuffer",t.onload=function(){audioCtx.decodeAudioData(this.response,function(t){if(!t)return void console.log("error");e.playSound(t)},function(e){console.log("decodeAudioData error")})},t.onerror=function(){console.log("Loader: XHR error")},t.send()},Loader.prototype.playSound=function(e){new Visualizer(e)};var Visualizer=function(e){this.sourceNode=audioCtx.createBufferSource(),this.sourceNode.buffer=e,this.analyserNode=audioCtx.createAnalyser(),this.freqs=new Uint8Array(this.analyserNode.frequencyBinCount),this.sourceNode.connect(this.analyserNode),this.analyserNode.connect(audioCtx.destination),this.sourceNode.start(0),this.draw()};Visualizer.prototype.draw=function(){this.analyserNode.smoothingTimeConstant=.98,this.analyserNode.fftSize=4096,this.analyserNode.getByteFrequencyData(this.freqs);var e=cw/this.analyserNode.frequencyBinCount;ctx.fillStyle="rgba(255, 255, 255, 1)",ctx.fillRect(0,0,cw,ch);for(var t=0;t<this.analyserNode.frequencyBinCount;++t){var o=this.freqs[t],n=o/255,i=ch*n;ctx.fillStyle="#ffff77",ctx.fillRect(cw/2+t*e/2,.9*ch,e,.2*-i),ctx.fillRect(cw/2+t*e/2,.9*ch-1,e,.1*i),ctx.fillRect(cw/2-t*e/2,.9*ch,e,.2*-i),ctx.fillRect(cw/2-t*e/2,.9*ch-1,e,.1*i)}window.requestAnimationFrame(this.draw.bind(this))};var setUpRAF=function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=e};setUpRAF();var loader=new Loader("sample.mp3");loader.loadBuffer();